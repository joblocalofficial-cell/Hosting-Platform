<script>
    // --- CONFIG ---
    // ‡πÉ‡∏ä‡πâ LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const LIFF_ID = "2008394776-k9v7m3Wg";  
    // Google Apps Script Web App URL ‡∏ó‡∏µ‡πà deploy ‡πÉ‡∏´‡∏°‡πà
    const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbzaCtiMdjlWzA3f95yH7vdjwYdi-8KJZ9zGjPOlQYVveLvFMHwyDlsnlxEMWiJE_xK2zQ/exec";  
    // --- End CONFIG ---  

    const $ = id => document.getElementById(id);
    const form = $("f");

    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
    let userProfile = {};
    let userIdToken = '';
    let liffReady = false;
    let latestSubmissionData = null; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏£‡∏≠‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

    // --- UI Elements ---
    const helloDiv = $("hello");
    const uidSmall = $("uid");
    const avatarImg = $("avatar");
    const submitBtn = $("submitBtn");
    const statusDiv = $("status");
    
    const userTypeSelect = $("user_type");
    const jobTitleSelect = $("job_title_select");
    const jobTitleOtherGroup = $("job_title_other_group");
    const jobTitleOtherInput = $("job_title_other");
    const companyOrgInput = $("company_or_org");
    const pdpaModal = $("pdpaModal");
    const showPdpaModalBtn = $("showPdpaModal");
    const closePdpaModalBtn = $("closePdpaModal");
    const wageTypeSelect = $("wage_type");
    const lumpSumDaysGroup = $("lump_sum_days_group");
    const lumpSumDaysInput = $("lump_sum_days");
    
    // Views
    const formView = $("form-view");
    const historyView = $("history-view");
    const latestSubmissionCard = $("latest-submission-card");
    const historyMessage = $("history-message"); // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô

    // --- LIFF Initialization ---
    async function initializeLiff() {
        try {
            await liff.init({ liffId: LIFF_ID });
            
            if (!liff.isLoggedIn()) {
                liff.login();
                return;
            }
            
            userProfile = await liff.getProfile();
            userIdToken = liff.getIDToken();
            liffReady = true;

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI
            helloDiv.textContent = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞, ${userProfile.displayName}`;
            uidSmall.textContent = `User ID: ${userProfile.userId.substring(0, 10)}...`;
            if (userProfile.pictureUrl) {
                avatarImg.src = userProfile.pictureUrl;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            const hasSubmitted = await checkSubmissionHistory(userProfile.userId);
            
            if (hasSubmitted) {
                // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
                showView('history', true); 
            } else {
                showView('form');
            }

        } catch (error) {
            console.error("LIFF initialization failed", error);
            helloDiv.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE";
            uidSmall.textContent = "‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô LINE";
        }
    }

    // --- NEW FUNCTION: ‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ---
    function showView(viewName, isHistory = false) {
        if (viewName === 'form') {
            formView.classList.remove('hidden');
            historyView.classList.add('hidden');
            submitBtn.disabled = false;
            submitBtn.textContent = "‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô";
            statusDiv.textContent = "‚úÖ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô";
        } else if (viewName === 'history') {
            formView.classList.add('hidden');
            historyView.classList.remove('hidden');
            
            // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô History View
            if (isHistory) {
                historyMessage.innerHTML = `
                    <span style="color: green; font-weight: bold;">
                        ‚úÖ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!
                    </span>
                    <br>
                    ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ **‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà** ‡∏´‡∏£‡∏∑‡∏≠ **‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•** ‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏î‡πâ
                `;
                
                // *** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° Action ‡πÉ‡∏´‡∏°‡πà 3 ‡∏õ‡∏∏‡πà‡∏° ***
                const oldButton = $("closeWindowBtn");
                if (oldButton) oldButton.remove(); // ‡∏•‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≠‡∏Å
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Box ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πà‡∏°
                let actionBox = $("historyActionBox");
                if (!actionBox) {
                    actionBox = document.createElement('div');
                    actionBox.id = 'historyActionBox';
                    actionBox.style.marginTop = '20px';
                    historyView.appendChild(actionBox);
                }
                
                actionBox.innerHTML = `
                    <button id="btnNewForm" class="btn-primary" style="margin-bottom: 10px;">‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
                    <button id="btnSendFlex" class="btn-success" style="background-color: #ff9800; margin-bottom: 10px;">‡∏î‡∏π/‡πÅ‡∏ä‡∏£‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô (Flex Message)</button>
                    <button id="btnCloseWindow" class="btn-secondary" style="background-color: #5bc0de;">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
                `;
                
                // 1. ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡∏°‡πà
                $("btnNewForm").addEventListener('click', () => {
                    form.reset(); // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏Å‡πà‡∏≤ (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
                    showView('form');
                });
                
                // 2. ‡∏™‡πà‡∏á Flex Message
                $("btnSendFlex").addEventListener('click', sendFlexMessage);
                
                // 3. ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
                $("btnCloseWindow").addEventListener('click', () => {
                     if (liff.closeWindow) liff.closeWindow();
                });
            }
        }
    }

    // --- checkSubmissionHistory (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥) ---
    async function checkSubmissionHistory(userId) {
        statusDiv.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°...";
        try {
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ doGet ‡πÉ‡∏ô GAS ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á userId ‡πÄ‡∏õ‡πá‡∏ô Parameter
            const checkUrl = `${GAS_ENDPOINT}?userId=${userId}`;
            const res = await fetch(checkUrl);
            const json = await res.json();
            
            console.log("History Check Response:", json);

            // *** ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Key ‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å GAS Endpoint (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ json.latestSubmission)
            if (json.status === "check_history" && json.hasSubmitted && json.latestSubmission) {
                // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ
                latestSubmissionData = json.latestSubmission;  
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤ History View
                renderHistoryCard(latestSubmissionData);
                return true; // ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
            } else {
                statusDiv.textContent = "‚úÖ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô";
                return false; // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            }

        } catch (err) {
            console.error("Error checking history:", err);
            statusDiv.textContent = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡∏°‡πà";
            return false;
        }
    }
    
    // --- renderHistoryCard (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•) ---
    function renderHistoryCard(data) {
        let html = '<p style="color:#00b900; font-weight:bold; margin-bottom: 15px;">**‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î**</p>';
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠ Key ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô History Card
        const displayMap = {
            '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°': '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',
            '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
            '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô': '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô',
            '‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•': '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•',
            '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå': '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',
            '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô': '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô', // Key ‡∏à‡∏≤‡∏Å GAS
            '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô': '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô', // Key ‡∏à‡∏≤‡∏Å GAS
            '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô': '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', // Key ‡∏à‡∏≤‡∏Å GAS
            '‡∏≠‡∏≥‡πÄ‡∏†‡∏≠': '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡∏≠‡∏≥‡πÄ‡∏†‡∏≠)', // Key ‡∏à‡∏≤‡∏Å GAS
            '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á': '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á', // Key ‡∏à‡∏≤‡∏Å GAS
            '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó)': '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á', // Key ‡∏à‡∏≤‡∏Å GAS
            '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô': '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô', // Key ‡∏à‡∏≤‡∏Å GAS
            '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô': '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô' // Key ‡∏à‡∏≤‡∏Å GAS
        };
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á (‡πÉ‡∏ä‡πâ key ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å GAS)
        const ignoreKeys = ['LINE User ID', '‡∏ä‡∏∑‡πà‡∏≠ LINE', '‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå URL', '‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏° PDPA', '‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô', '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á', 'LINE ID ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á', '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'];

        // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        for (const key in data) {
            if (data[key] && !ignoreKeys.includes(key) && displayMap[key]) {
                const label = displayMap[key];
                let value = data[key];
                
                // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏≤‡∏á Field
                if (key === '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó)') {
                    value = `${parseFloat(value).toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó`;
                } 
                
                if (key === '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô') {
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
                    html += `
                        <div class="history-item" style="border-bottom: none;">
                            <span class="history-label" style="display: block; width: auto; margin-bottom: 5px;">${label}:</span>
                            <span class="history-value" style="display: block; white-space: pre-wrap;">${value}</span>
                        </div>
                    `;
                    continue; // ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                }

                html += `
                    <div class="history-item">
                        <span class="history-label">${label}:</span>
                        <span class="history-value">${value}</span>
                    </div>
                `;
            }
        }
        
        // ‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πâ‡∏≤‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢
        if (data['‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á'] === '‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πâ‡∏≤‡∏á' && data['‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô']) {
              html += `
                <div class="history-item">
                    <span class="history-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πâ‡∏≤‡∏á:</span>
                    <span class="history-value">${data['‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô']} ‡∏ß‡∏±‡∏ô</span>
                </div>
            `;
        }

        latestSubmissionCard.innerHTML = html;
        latestSubmissionCard.style.borderLeft = '5px solid #00b900'; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡πâ‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏î‡πà‡∏ô
    }

    // --- NEW FUNCTION: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á Flex Message ---
    async function sendFlexMessage() {
        if (!liff.isApiAvailable('sendMessages') || !latestSubmissionData) {
            alert('‚ùå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô LINE Browser ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î');
            return;
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Flex
        const data = latestSubmissionData;
        const wageText = data['‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á'] && data['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó)'] ? 
                        `${data['‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á']} ${parseFloat(data['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó)']).toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó` : 'N/A';
        const locationText = `${data['‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô'] || 'N/A'} (${data['‡∏≠‡∏≥‡πÄ‡∏†‡∏≠'] || 'N/A'})`;
        const jobTitle = data['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô'] || '‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà';

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message JSON (‡πÉ‡∏ä‡πâ Bubble Template ‡∏á‡πà‡∏≤‡∏¢‡πÜ)
        const flexMessage = {
            type: "flex",
            altText: `‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô: ${jobTitle} - ${data['‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•'] || 'N/A'}`,
            contents: {
                type: "bubble",
                size: "giga",
                header: {
                    type: "box",
                    layout: "vertical",
                    contents: [
                        {
                            type: "text",
                            text: `üì£ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô: ${jobTitle}`,
                            weight: "bold",
                            color: "#FFFFFF",
                            size: "md",
                            wrap: true
                        }
                    ],
                    paddingAll: "15px",
                    backgroundColor: "#00B900"
                },
                body: {
                    type: "box",
                    layout: "vertical",
                    spacing: "sm",
                    contents: [
                        {
                            type: "box",
                            layout: "baseline",
                            contents: [
                                { type: "text", text: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏ú‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á:", color: "#aaaaaa", flex: 3 },
                                { type: "text", text: data['‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•'] || "N/A", flex: 5, wrap: true }
                            ]
                        },
                        {
                            type: "box",
                            layout: "baseline",
                            contents: [
                                { type: "text", text: "‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á:", color: "#aaaaaa", flex: 3 },
                                { type: "text", text: wageText, color: "#FF6600", flex: 5, weight: "bold" }
                            ]
                        },
                        {
                            type: "box",
                            layout: "baseline",
                            contents: [
                                { type: "text", text: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:", color: "#aaaaaa", flex: 3 },
                                { type: "text", text: locationText, flex: 5, wrap: true }
                            ]
                        },
                        {
                            type: "box",
                            layout: "vertical",
                            margin: "md",
                            contents: [
                                { type: "text", text: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:", color: "#aaaaaa", size: "sm" },
                                { type: "text", text: data['‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô'] ? data['‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô'].substring(0, 150) + '...' : "N/A", wrap: true, margin: "sm", size: "sm" }
                            ]
                        },
                        {
                            type: "box",
                            layout: "baseline",
                            margin: "md",
                            contents: [
                                { type: "text", text: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:", color: "#aaaaaa", flex: 3 },
                                { type: "text", text: data['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] || "‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö", color: (data['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'] === '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' ? '#FFCC00' : '#009900'), flex: 5, weight: "bold" }
                            ]
                        }
                    ]
                },
                footer: {
                    type: "box",
                    layout: "vertical",
                    contents: [
                        {
                            type: "button",
                            action: {
                                type: "uri",
                                label: "‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏±‡∏Ñ‡∏£",
                                // ‡πÉ‡∏ä‡πâ liff.getLineURL() ‡∏´‡∏£‡∏∑‡∏≠ URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á
                                uri: "https://liff.line.me/" + LIFF_ID 
                            },
                            style: "primary",
                            color: "#00B900"
                        }
                    ]
                }
            }
        };

        try {
            await liff.sendMessages([flexMessage]);
            alert('‡∏™‡πà‡∏á Flex Message ‡πÄ‡∏Ç‡πâ‡∏≤ LINE Chat ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÅ‡∏ä‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ');
            // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏á
        } catch (err) {
            console.error('Error sending Flex Message:', err);
            alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á Flex Message ‡πÑ‡∏î‡πâ (‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå LIFF ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)');
        }
    }

    // --- Event Listeners ---
    // 1. PDPA Modal Handlers (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
    showPdpaModalBtn.addEventListener('click', () => { pdpaModal.style.display = 'flex'; });
    closePdpaModalBtn.addEventListener('click', () => { pdpaModal.style.display = 'none'; });
    pdpaModal.addEventListener('click', (e) => {
        if (e.target.id === 'pdpaModal') { pdpaModal.style.display = 'none'; }
    });

    // 2. Conditional Input Handlers (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
    userTypeSelect.addEventListener('change', (e) => {
        const val = e.target.value;
        if (val === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' || val === '‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ / ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏¢‡πà‡∏≠‡∏¢') {
            companyOrgInput.placeholder = "‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•/‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£";
        } else {
            companyOrgInput.placeholder = "‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£";
        }
    });
    
    jobTitleSelect.addEventListener('change', (e) => {
        if (e.target.value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
            jobTitleOtherGroup.classList.remove('hidden');
            jobTitleOtherInput.setAttribute('required', 'required');
        } else {
            jobTitleOtherGroup.classList.add('hidden');
            jobTitleOtherInput.removeAttribute('required');
            jobTitleOtherInput.value = '';
        }
    });

    wageTypeSelect.addEventListener('change', (e) => {
        if (e.target.value === '‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πâ‡∏≤‡∏á') {
            lumpSumDaysGroup.classList.remove('hidden');
            lumpSumDaysInput.setAttribute('required', 'required');
        } else {
            lumpSumDaysGroup.classList.add('hidden');
            lumpSumDaysInput.removeAttribute('required');
            lumpSumDaysInput.value = '';
        }
    });

    // *** ‡∏•‡∏ö Event Listener ‡∏Ç‡∏≠‡∏á closeWindowBtn ‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≠‡∏Å ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ô showView('history') ‡πÅ‡∏•‡πâ‡∏ß ***
    
    // 4. Form Submission Handler (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!liffReady || !userIdToken || !userProfile.userId) {  
            statusDiv.textContent = "‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• LINE ‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";  
            submitBtn.disabled = false;
            submitBtn.textContent = "‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô";
            return;  
        }
        
        // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á
        const selectedJobTitle = jobTitleSelect.value;
        const finalJobTitle = selectedJobTitle === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'  
            ? jobTitleOtherInput.value  
            : selectedJobTitle;
        
        // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á
        const formData = {
            pdpa_consent: $("consent_pdpa").checked ? "‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö" : "‡πÑ‡∏°‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö",
            user_type: userTypeSelect.value,
            company_or_org: companyOrgInput.value,
            contact_person: $("contact_person").value,
            contact_phone: $("contact_phone").value,
            job_title: finalJobTitle, // ‡πÉ‡∏ä‡πâ finalJobTitle
            job_category: $("job_category").value,
            job_description: $("job_description").value,
            location_area: $("location_area").value,
            district: $("district").value,
            headcount: $("headcount").value,
            wage_type: wageTypeSelect.value,
            lump_sum_days: wageTypeSelect.value === '‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πâ‡∏≤‡∏á' ? lumpSumDaysInput.value : "",  
            wage_amount: $("wage_amount").value,
            start_date: $("start_date").value,
            start_time: $("start_time").value,
            contact_line_id: $("contact_line_id").value
        };

        submitBtn.disabled = true;
        submitBtn.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
        statusDiv.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶";

        const payload = {
            idToken: userIdToken,
            profile: {
                userId: userProfile.userId,
                displayName: userProfile.displayName,
                pictureUrl: userProfile.pictureUrl || ""
            },
            data: formData  
        };

        try {
            const res = await fetch(GAS_ENDPOINT, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(payload),
                mode: 'no-cors'  
            });

            if (res.type === 'opaque') {
                statusDiv.textContent = "‚úÖ ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î...";
                submitBtn.textContent = "‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏™‡πà‡∏á‡πÑ‡∏õ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ latestSubmissionData ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó)
                await checkSubmissionHistory(userProfile.userId);  
                
                // ‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                showView('history', true);  
                
                return;
            }

        } catch (err) {
            console.error("Error:", err);
            statusDiv.textContent = "‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err.message;
            submitBtn.disabled = false;
            submitBtn.textContent = "‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏á‡∏≤‡∏ô";
        }
    });

    // Start LIFF
    initializeLiff();
</script>
